<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="温故而知新"><title>logstash常用插件 | 怪叔叔的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">logstash常用插件</h1><a id="logo" href="/.">怪叔叔的博客</a><p class="description">攀峰之高险，岂有崖巅。搏海之明辉，何来彼岸。前进不止，奋斗不息。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">logstash常用插件</h1><div class="post-meta">Dec 18, 2018</div><div class="post-content"><h4 id="常用插件说明"><a href="#常用插件说明" class="headerlink" title="常用插件说明"></a>常用插件说明</h4><p><code>Filter</code>是Logstash功能强大的主要原因,它可以对Logstash Event进行丰富的处理,比如说解析数据、删除字段、类型转换等等,常见的有如下几个：</p>
<ul>
<li>date:日志解析</li>
<li>grok:正则匹配解析</li>
<li>dissect: 分隔符解析</li>
<li>mutate: 对字段做处理,比如重命名，删除替换等</li>
<li>json: 按照json解析字段内容到指定字段中</li>
<li>geoip: 增加地理位置数据</li>
<li>ruby: 利用ruby代码来动态修改logstash Event</li>
</ul>
<h5 id="data-插件"><a href="#data-插件" class="headerlink" title="data 插件"></a>data 插件</h5><p>用来转换日志记录中的时间字符串，变成LogStash::Timestamp 对象，然后转存到 @timestamp 字段里。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line"></span><br><span class="line">    grok &#123;</span><br><span class="line"></span><br><span class="line">        match =&gt; [&quot;message&quot;, &quot;%&#123;HTTPDATE:logdate&#125;&quot;]</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    date &#123;</span><br><span class="line"></span><br><span class="line">        match =&gt; [&quot;logdate&quot;, &quot;dd/MMM/yyyy:HH:mm:ss Z&quot;]</span><br><span class="line"></span><br><span class="line">        ### 如果不想timestamp相差8个小时可以通过下面配置解决</span><br><span class="line">        locale =&gt; &quot;en&quot;</span><br><span class="line">        timezone =&gt; &quot;+00:00&quot;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>说明:<br><code>match</code>：类型为数组，用于指定日期匹配格式，可以一次指定多种日志格式。<br>关于logstash时区的问题，可以可以参考:<a href="https://www.zybuluo.com/StrGlee/note/1179723" target="_blank" rel="noopener">logstash时间戳时区问题</a></p>
<h5 id="grok-正则匹配"><a href="#grok-正则匹配" class="headerlink" title="grok 正则匹配"></a>grok 正则匹配</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line"></span><br><span class="line">     grok &#123;</span><br><span class="line">         match =&gt; [ &quot;message&quot;,  &quot;\s+(?&lt;status&gt;\d+?)\s+&quot; ] #比如匹配尖括号中所有内容需要这么写\&lt;.*?\&gt; ,匹配尖括号中一个或者多个日志需要这么写\&lt;\(\d+\)\&gt;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Grok语法"><a href="#Grok语法" class="headerlink" title="Grok语法"></a>Grok语法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%&#123;SYNTAX:SEMANTIC&#125;   # SYNTAX为grok pattern的名称，SEMANTIC为赋值字段名称</span><br><span class="line">%&#123;NUMBER:duration&#125;可以匹配数值类型，但是grok匹配出的内容都是字符串类型，可以通过在最后指定为int或者float来强制转换类型。</span><br><span class="line">%&#123;NUMBER:duration:float&#125;</span><br></pre></td></tr></table></figure>
<p>在线调试正则表达式:<br><a href="https://regexr.com/" target="_blank" rel="noopener">https://regexr.com/</a></p>
<p>grok在线调试<br><a href="http://grokdebug.herokuapp.com/" target="_blank" rel="noopener">http://grokdebug.herokuapp.com/</a><br><a href="http://grok.elasticsearch.cn/" target="_blank" rel="noopener">http://grok.elasticsearch.cn/</a></p>
<h5 id="dissect插件"><a href="#dissect插件" class="headerlink" title="dissect插件"></a><a href="https://www.elastic.co/guide/en/logstash/6.2/plugins-filters-dissect.html" target="_blank" rel="noopener">dissect插件</a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Apr 26 12:20:02</span><br><span class="line">%&#123;ts&#125; %&#123;+ts&#125; %&#123;+ts&#125;     #+代表该匹配值追加到ts字段下</span><br><span class="line">&#123;</span><br><span class="line">    &quot;ts&quot;:&quot;Apr 26 12:20:02&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">two three one go</span><br><span class="line">%&#123;+order/2&#125; %&#123;+order/3&#125; %&#123;+order/1&#125; %&#123;+order/4&#125;     #/后面的数字代表拼接的次序</span><br><span class="line">&#123;</span><br><span class="line">    &quot;order&quot;: &quot;one two three go&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a=1&amp;b=2</span><br><span class="line">%&#123;?key1&#125;=%&#123;&amp;key1&#125;&amp;%&#123;?key2&#125;=%&#123;&amp;key2&#125;  #%&#123;?&#125;代表忽略匹配值，但是富裕字段名，用于后续匹配用；%&#123;&amp;&#125;代表将匹配值赋予key1的匹配值</span><br><span class="line">&#123;</span><br><span class="line">    &quot;a&quot;:&quot;1&quot;,</span><br><span class="line">    &quot;b&quot;:&quot;2&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#dissect可以自动处理空的匹配值</span><br><span class="line">John Smith,Big Oaks,Wood Lane,Hambledown,Canterbury,CB34RY</span><br><span class="line">%&#123;name&#125;,%&#123;addr1&#125;,%&#123;addr2&#125;,%&#123;addr3&#125;,%&#123;city&#125;,%&#123;zip&#125;</span><br><span class="line"></span><br><span class="line">Jane Doe,4321 Fifth Avenue,,,New York,87432</span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;:&quot;Jane Doe&quot;,</span><br><span class="line">    &quot;addr1&quot;:&quot;4321 Fifth Avenue&quot;,</span><br><span class="line">    &quot;addr2&quot;:&quot;&quot;,</span><br><span class="line">    &quot;addr3&quot;:&quot;&quot;,</span><br><span class="line">    &quot;city&quot;:&quot;New York&quot;,</span><br><span class="line">    &quot;zip&quot;:&quot;87432&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#dissect分割后的字段值都是字符串，可以使用convert_datatype属性进行类型转换</span><br><span class="line">filter&#123;</span><br><span class="line">    dissect&#123;</span><br><span class="line">        convert_datatype =&gt; &#123;age =&gt; &quot;int&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="mutate插件"><a href="#mutate插件" class="headerlink" title="mutate插件"></a><a href="https://www.elastic.co/guide/en/logstash/6.2/plugins-filters-mutate.html" target="_blank" rel="noopener">mutate插件</a></h5><p>用最频繁的操作，可以对字段进行各种操作，比如重命名、删除、替换、更新等，主要操作如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">convert   #类型转换</span><br><span class="line">gsub      #字符串替换</span><br><span class="line">split/join/merge    #字符串切割、数组合并为字符串、数组合并为数组</span><br><span class="line">rename    #字段重命名</span><br><span class="line">update/replace   #字段内容更新或替换</span><br><span class="line">remove_field     #删除字段</span><br></pre></td></tr></table></figure></p>
<p><code>convert</code>: 实现字段类型的转换,类型为hash,仅支持转换为integer、float、string和Boolean<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filter&#123;</span><br><span class="line">    mutate&#123;</span><br><span class="line">        convert =&gt; &#123;&quot;age&quot; =&gt; &quot;integer&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>gsub</code>:对字段内容进行替换，类型为数组，每3项为一个替换配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">filter&#123;</span><br><span class="line">## 去除字段这里去除的是对应的变量</span><br><span class="line">mutate &#123;</span><br><span class="line">  remove_field =&gt; &quot;@version&quot;</span><br><span class="line">  remove_field =&gt; &quot;host&quot;</span><br><span class="line">  remove_field =&gt; &quot;type&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## 替换字段</span><br><span class="line">mutate&#123;</span><br><span class="line">convert =&gt; [&quot;message&quot;, &quot;string&quot;]</span><br><span class="line">gsub =&gt; [ &quot;message&quot;, &quot;\&lt;.*?\&gt;&quot;, &quot;&quot; ]  ## 删除尖括号和尖括号包含的内容</span><br><span class="line">gsub =&gt; [ &quot;message&quot;, &quot;;&quot; ,&quot;:&quot;]  ##将; 替换为:</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>剩下的暂不做详细说明</p>
<h5 id="json插件"><a href="#json插件" class="headerlink" title="json插件"></a><a href="https://www.elastic.co/guide/en/logstash/6.2/plugins-filters-json.html" target="_blank" rel="noopener">json插件</a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">  json &#123;</span><br><span class="line">    source =&gt; &quot;message&quot;  #需要解析的字段名</span><br><span class="line">    target =&gt; &quot;doc&quot;      # 解析之后存储的字段名，默认和message同一级别</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="geoip插件"><a href="#geoip插件" class="headerlink" title="geoip插件"></a><a href="https://www.elastic.co/guide/en/logstash/6.2/plugins-filters-geoip.html" target="_blank" rel="noopener">geoip插件</a></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">  geoip &#123;</span><br><span class="line">    source =&gt; &quot;clientip&quot; ## 过滤ip</span><br><span class="line">    database =&gt; &quot;/etc/logstash/GeoLiteCity.dat&quot;       #需去官网下载ip库放到本地</span><br><span class="line">    add_field =&gt; &#123;“foo _％&#123;somefield&#125;”=&gt;“Hello world，from％&#123;host&#125;”&#125; ## 添加字段</span><br><span class="line">    add_tag =&gt; [“foo _％&#123;somefield&#125;”，“taggedy_tag”]    ## 添加标签</span><br><span class="line">    id =&gt; &quot;ABC&quot;   #设置id值</span><br><span class="line">    remove_field =&gt; [“foo _％&#123;somefield&#125;”，“my_extraneous_field”]  #删除多个字段</span><br><span class="line">    remove_tag =&gt; [“foo _％&#123;somefield&#125;”，“sad_unwanted_tag”] ## 删除多个标签</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ruby插件"><a href="#ruby插件" class="headerlink" title="ruby插件"></a><a href="https://www.elastic.co/guide/en/logstash/6.2/plugins-filters-ruby.html" target="_blank" rel="noopener">ruby插件</a></h5><p>ruby可以修改logstash Event对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">filter&#123;</span><br><span class="line">    ruby&#123;</span><br><span class="line">        code =&gt; &apos;size = event.get(&quot;message&quot;).size;</span><br><span class="line">                event.set(&quot;message_size&quot;,size)&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ruby &#123;</span><br><span class="line">        code =&gt; &quot;event.set(&apos;@read_timestamp&apos;,event.get(&apos;@timestamp&apos;))&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>参考1：<a href="http://doc.yonyoucloud.com/doc/logstash-best-practice-cn/get_start/index.html" target="_blank" rel="noopener">http://doc.yonyoucloud.com/doc/logstash-best-practice-cn/get_start/index.html</a></p>
</div><div class="tags"><a href="/tags/ELK/">ELK</a></div><div class="post-nav"><a class="next" href="/2018/12/16/ELK-logstash启动慢的解决方法/">ELK logstash启动慢的解决方法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://dingbingbing.top"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/ELK/" style="font-size: 15px;">ELK</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/tags/salt/" style="font-size: 15px;">salt</a> <a href="/tags/vim-Golang/" style="font-size: 15px;">vim Golang</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/18/logstash常用插件/">logstash常用插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/16/ELK-logstash启动慢的解决方法/">ELK logstash启动慢的解决方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/12/git常用命令/">git常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/12/ELk部署/">ELk部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/saltstack部署使用/">saltstack部署使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/07/Gerrit部署使用/">Gerrit部署使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/06/GO流程控制/">GO流程控制</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/06/vim安装markdown插件/">vim安装markdown插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/02/Go编程基础/">Go编程基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/27/ELK部署并且配置sudo日志分析/">ELK部署并且配置sudo日志分析</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">怪叔叔的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>